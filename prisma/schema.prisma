generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Profile {
  id     String  @id @db.Uuid // Matches Supabase Auth ID
  name   String
  avatar String?

  // Stripe / Subscription logic
  stripeCustomerId       String?   @unique
  subscriptionTier       String    @default("free") // "free", "agency", "pro"
  stripeCurrentPeriodEnd DateTime?

  // Relations
  dashboards    Dashboard[]
  brandProfiles BrandProfile[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("profiles")
}

model BrandProfile {
  id        String @id @default(cuid())
  profileId String @db.Uuid
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  name         String  // e.g., "Client A", "Personal Brand"
  primaryColor String  @default("#4f39f6")
  secondaryColor String?
  fontFamily   String  @default("Inter")
  logoUrl      String? // For the watermark overlay

  charts       Chart[] // Links charts to this specific brand style

  @@map("brand_profiles")
}

model Dashboard {
  id        String @id @default(cuid())
  slug      String @unique // For public sharing: yourtool.com/share/slug
  profileId String @db.Uuid
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  title     String
  isPublic  Boolean @default(false)

  // Intermediate Relation: A dashboard can have many charts
  charts    Chart[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("dashboards")
}

model Chart {
  id          String    @id @default(cuid())
  dashboardId String
  dashboard   Dashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
  
  brandProfileId String?
  brandProfile   BrandProfile? @relation(fields: [brandProfileId], references: [id])

  name        String
  type        String    @default("bar") // bar, line, pie, etc.
  
  // THE CORE DATA
  // rawData stores the vue3-excel-editor array
  rawData     Json      
  
  // THE VIBE
  // config stores specific ECharts overrides (annotations, grid settings, etc.)
  config      Json      

  order       Int       @default(0) // For positioning multiple charts later

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("charts")
}

model Waitlist {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique
  createdAt DateTime @default(now())

  @@map("waitlist")
}